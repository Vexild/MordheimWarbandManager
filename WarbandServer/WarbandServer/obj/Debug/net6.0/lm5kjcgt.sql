CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "User" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Pass" character varying(255) NOT NULL,
    "Mail" character varying(255) NOT NULL,
    "PrivateUser" boolean NOT NULL,
    "Joined" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_User" PRIMARY KEY ("Id")
);

INSERT INTO "User" ("Id", "Joined", "Mail", "Name", "Pass", "PrivateUser")
VALUES (1, TIMESTAMPTZ '-infinity', 'testmail1.com', 'Test User 1', 'Non-hashed-password1', FALSE);
INSERT INTO "User" ("Id", "Joined", "Mail", "Name", "Pass", "PrivateUser")
VALUES (2, TIMESTAMPTZ '-infinity', 'testmail2.com', 'Test User 2', 'Non-hashed-password2', FALSE);

SELECT setval(
    pg_get_serial_sequence('"User"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "User") + 1,
        nextval(pg_get_serial_sequence('"User"', 'Id'))),
    false);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230222074427_InitialMigration', '7.0.3');

COMMIT;

START TRANSACTION;

UPDATE "User" SET "Name" = 'Test User 11'
WHERE "Id" = 1;

UPDATE "User" SET "Name" = 'Test User 22'
WHERE "Id" = 2;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230222121542_secondMigration', '7.0.3');

COMMIT;

